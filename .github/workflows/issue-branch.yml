name: '1. Issue â†’ Create Branch'

on:
  issues:
    types: [opened, reopened]

permissions:
  contents: write

jobs:
  create-branch:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Create Branch
        env:
          TITLE: ${{ github.event.issue.title }}
          NUM: ${{ github.event.issue.number }}
          BASE_BRANCH: main
        run: |
          SLUG=$(echo "$TITLE" | tr '[:upper:]' '[:lower:]' | tr ' ' '_')
          BRANCH_NAME="${NUM}-${SLUG}"

          if ! git ls-remote --exit-code --heads origin "$BRANCH_NAME"; then
            git config user.name "github-actions"
            git config user.email "actions@github.com"
          
            git checkout -b "$BRANCH_NAME" "origin/$BASE_BRANCH"
            git push origin "$BRANCH_NAME"
            echo "Branch created : $BRANCH_NAME"
          else
            echo "Branch already exists."
          fi